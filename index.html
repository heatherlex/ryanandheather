<script>
  const video = document.getElementById('introVideo');
  const iframeContainer = document.getElementById('iframeContainer');
  const videoContainer = document.getElementById('videoContainer');
  const overlayMessage = document.getElementById('overlayMessage');
  const formContainer = document.getElementById('formContainer');
  const topSkipMessage = document.getElementById('topSkipMessage');
  const customForm = document.getElementById('customForm');
  const submitButton = customForm.querySelector('button[type="submit"]');

  let hasStarted = false;

  function startVideo() {
    if (!hasStarted) {
      hasStarted = true;
      video.style.display = 'block';
      topSkipMessage.style.display = 'block';
      video.muted = true;
      video.load();
      video.play()
        .then(() => {
          video.muted = false;
          overlayMessage.style.display = 'none';
        })
        .catch(err => {
          console.error('Playback failed:', err);
          overlayMessage.innerText = 'Tap to try again';
        });
    }
  }

  function skipVideo() {
    if (hasStarted && !video.paused) {
      video.pause();
      video.style.display = 'none';
      overlayMessage.style.display = 'none';
      formContainer.style.display = 'flex';
      topSkipMessage.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
  }

  // ** Only preventDefault for taps on the videoContainer (to handle skip/play toggle ) **
  videoContainer.addEventListener('touchstart', e => {
    if (e.target === video || e.target === overlayMessage || e.target === videoContainer) {
      e.preventDefault();
      if (!hasStarted) startVideo();
      else skipVideo();
    }
  }, { passive: false });

  // Desktop fallback
  videoContainer.addEventListener('click', e => {
    if (e.target === video || e.target === overlayMessage || e.target === videoContainer) {
      if (!hasStarted) startVideo();
      else skipVideo();
    }
  });

  video.addEventListener('ended', () => {
    video.style.display = 'none';
    formContainer.style.display = 'flex';
    topSkipMessage.style.display = 'none';
    document.body.style.overflow = 'auto';
  });

  // Submit logic:
  customForm.addEventListener('submit', e => {
    e.preventDefault();
    console.log('Form submitted!'); // debugging

    submitButton.disabled = true;
    submitButton.innerText = 'Submitting...';

    const url = 'https://docs.google.com/forms/d/e/1FAIpQLSfDSXRR0wmxZJCbK9W5DwNa3nFnpoK6M3Z96q541rj3jBdGAA/formResponse';
    const data = new FormData(customForm);

    fetch(url, { method: 'POST', mode: 'no-cors', body: data })
      .finally(() => {
        setTimeout(() => {
          window.location.href = 'https://www.withjoy.com/ryanheather';
        }, 500);
      });
  });
</script>
